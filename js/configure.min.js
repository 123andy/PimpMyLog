/* jshint devel:true *//*global lemma*//**
 * Activate the striped effect of the progressbar
 *
 * @return  {void}
 */var progressbar_active=function(){$(".progress").addClass("progress-striped active")},progressbar_deactive=function(){$(".progress").removeClass("progress-striped active")},progressbar_set=function(e){var t=Math.max(0,Math.min(100,parseInt(e,10)));$(".progress .sr-only").text(lemma.complete.replace("%s",t));$(".progress-bar").prop("aria-valuenow",t).width(t+"%")},progressbar_color=function(e){$(".progress-bar").removeClass("progress-bar-success progress-bar-info progress-bar-warning progress-bar-success progress-bar-danger");e!==undefined&&$(".progress-bar").addClass("progress-bar-"+e)},fatal_error=function(e){e||(e=lemma.error);progressbar_color("danger");progressbar_set(100);$('<div class="alert alert-danger fade in">'+e+"</div>").appendTo("#error");$("#user").text("");$("#reload").hide();$("#next").hide()},pml_action=function(e,t,n){progressbar_active();$.ajax({url:"configure.php?"+(new Date).getTime(),data:e,type:"POST",dataType:"json"}).fail(function(e,t,n){progressbar_color("danger");progressbar_set(100);$('<div class="alert alert-danger fade in">'+n.message+"</div>").appendTo("#error")}).done(function(e){e.error?fatal_error(e.error):t(e,n)}).always(function(e){e.reload?$("#reload").show():$("#reload").hide();e.next?$("#next").show():$("#next").hide().unbind("click");progressbar_deactive()})},action_configue_now=function(e){$("#error").text("");$("#user").text("");$(".alert").remove();progressbar_set(80);pml_action({s:"configure",l:e},function(){progressbar_set(100);progressbar_color("success");$("#congratulations").show();$("#error").hide();$("#user").hide();$("#buttons").hide()})},logs_list=[],action_select_logs=function(e){var t=e.a,n=e.b,r=e.c,i=40,s=60,o=parseInt(i+(r-n.length)/r*(s-i),10);progressbar_set(o);if(n.length===0){action_configue_now(logs_list);return}var u=n.pop();pml_action({s:"find",so:u},function(e){$("#user").html(e.notice);var i="";if(e.found===0)progressbar_color("danger");else if(e.found===1)progressbar_color("warning");else{progressbar_color();i='style="display:none;"'}$("#find").addClass("table table-striped table-bordered table-hover table-condensed").append('<thead><tr><th><input type="checkbox" id="all"></th><th>'+lemma.path+"</th><th>"+lemma.file+"</th><th>"+lemma.type+"</th><th>"+lemma.readable+"</th></tr></thead><tbody></tbody>");for(var s in e.files)for(var o in e.files[s])if(e.files[s][o]===!0)$("#find tbody").append("<tr "+i+"><td></td><td>"+o+'</td><td></td><td></td><td><span class="label label-success">'+lemma.yes+"</span></td></tr>");else if(e.files[s][o]===!1)$("#find tbody").append("<tr "+i+"><td></td><td>"+o+'</td><td></td><td></td><td><span class="label label-danger">'+lemma.no+"</span></td></tr>");else for(var u in e.files[s][o])for(var a in e.files[s][o][u]){var f=e.files[s][o][u][a];$("<tr>").data("file",{s:s,f:o+f,t:u}).html('<td><input type="checkbox"></td><td>'+o+"</td><td>"+f+"</td><td>"+u+'</td><td><span class="label label-success">'+lemma.yes+"</span></td>").appendTo("#find tbody")}$("#find tbody tr").click(function(){var e=$(this).find('input[type="checkbox"]');if($(e)){var t=$(e).prop("checked");$(e).prop("checked",t);t?$(this).addClass("success"):$(this).removeClass("success")}});$("#find #all").click(function(){var e=$(this).prop("checked");$("#find tbody tr").each(function(){var t=$(this).find('input[type="checkbox"]');if(t.length===1){$(t).prop("checked",e);e?$(this).addClass("success"):$(this).removeClass("success")}})});$("#find #all").click();$("#next").unbind("click").click(function(){var e=!1,i=[];$(".userpaths").each(function(){var e=$.trim($(this).val()).split(",");if(e.length>0)for(var t in e){var n=$.trim(e[t]);n!==""&&i.push({s:$(this).data("soft"),t:$(this).data("type"),f:n})}});if(i.length>0){pml_action({s:"check",uf:i},function(e){if(e.notice)$(".alert").removeClass("alert-success").addClass("alert-warning").html(e.notice);else{$("#error").text("");$(".alert").remove();$('#find tbody tr input[type="checkbox"]:checked').each(function(){logs_list.push($(this).parents("tr").data("file"))});logs_list=$.merge(logs_list,e.found);action_select_logs({a:t,b:n,c:r})}});return}$('#find tbody tr input[type="checkbox"]:checked').each(function(){logs_list.push($(this).parents("tr").data("file"));e=!0});if(e===!0){$("#error").text("");$(".alert").remove();action_select_logs({a:t,b:n,c:r})}else $(".alert").removeClass("alert-success").addClass("alert-warning").html(lemma.chooselog)})})};$(function(){progressbar_set(10);pml_action({s:"exist"},function(){progressbar_set(20);pml_action({s:"touch"},function(e){if(e.notice){$("#user").html(e.notice);progressbar_color("warning")}else{$("#user").html(lemma.pleasewait);progressbar_set(30);pml_action({s:"soft"},function(e){if(e.sofn>0){var t=[];if(e.sofn>1){$("#user").html(e.notice);$("#soft").addClass("table table-striped table-bordered table-hover table-condensed").append('<thead><tr><th><input type="checkbox" id="all"></th><th>'+lemma.name+"</th><th>"+lemma.description+"</th><th>"+lemma.notes+"</th></tr></thead><tbody></tbody>");for(var n in e.soft){var r=e.soft[n].home,i=r===undefined||r===""?e.soft[n].name:'<a href="'+r+'" target="doc">'+e.soft[n].name+"</a>";$("<tr>").data("softid",n).data("load",e.soft[n].load).html('<td><input type="checkbox"></td><td>'+i+"</td><td>"+e.soft[n].desc+"</td><td>"+e.soft[n].notes+"</td>").appendTo("#soft tbody")}$("#soft tbody tr").click(function(){var e=$(this).find('input[type="checkbox"]');if($(e)){var t=$(e).prop("checked");t?$(this).addClass("success"):$(this).removeClass("success")}});$('#soft tbody tr input[type="checkbox"]').each(function(){if($(this).parents("tr").data("load")){$(this).prop("checked",!0);$(this).parents("tr").addClass("success")}});$("#soft #all").click(function(){var e=$(this).prop("checked");$("#soft tbody tr").each(function(){var t=$(this).find('input[type="checkbox"]');$(t).prop("checked",e);e?$(this).addClass("success"):$(this).removeClass("success")})});$("#next").unbind("click").click(function(){$('#soft tbody tr input[type="checkbox"]:checked').each(function(){t.push($(this).parents("tr").data("softid"))});if(t.length>0){$("#error").text("");action_select_logs({a:e.soft,b:t,c:t.length})}else $('<div class="alert alert-warning fade in">'+lemma.choosesoftware+"</div>").appendTo("#error")})}else{for(var s in e.soft)t.push(s);action_select_logs({a:e.soft,b:t,c:t.length})}}else fatal_error()})}})})});